<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The OpenAPI Imperative: An Interactive Exploration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism-okaidia.min.css">

    <!-- Chosen Palette: Cosmic Latte & Tech Blue -->
    <!-- Application Structure Plan: The page is now streamlined to focus on the interactive tools. It leads with the AI Readiness Monitor and the AI-Powered Refinement section. The conceptual and case-study sections have been removed to create a more direct, tool-focused experience. -->
    <!-- Visualization & Content Choices: 
        - Section Order: 1. AI Readiness Monitor, 2. AI-Powered Refinement, 3. Workflow, 4. Conclusion.
        - AI Logic Enhancement: The fixSpecWithAI function generates meaningful descriptions instead of placeholders.
        - Library/Method: Vanilla JS, Chart.js, and js-yaml are used. Prism.js is added for code highlighting. The AI logic is simulated in JavaScript to demonstrate the concept. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        html {
            scroll-behavior: smooth;
            scroll-padding-top: 4rem; /* 64px, equal to h-16 */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F7F4;
            color: #2c3e50;
        }
        .bg-primary { background-color: #F8F7F4; }
        .bg-secondary { background-color: #FFFFFF; }
        .text-accent { color: #4A90E2; }
        .border-accent { border-color: #4A90E2; }
        .bg-accent { background-color: #4A90E2; }
        .bg-accent-light { background-color: #EAF2FB; }
        pre[class*="language-"] {
            font-size: 0.875rem;
            border-radius: 0.5rem;
            border: 1px solid #ddd;
        }
         @media (min-width: 1024px) {
             .ai-fixer-grid {
                grid-template-columns: 1fr 1fr;
            }
            .spec-render-grid {
                grid-template-columns: 1fr 1fr;
            }
         }
        .gauge-container {
            width: 250px;
            height: 125px;
            position: relative;
            overflow: hidden;
        }
        .gauge-background {
            width: 100%;
            height: 100%;
            background: conic-gradient(from -90deg at 50% 100%, #ef4444, #f97316, #eab308, #84cc16, #22c55e);
            border-radius: 250px 250px 0 0;
        }
        .gauge-mask {
            width: 210px;
            height: 105px;
            background: #FFFFFF; /* Match the conclusion background */
            position: absolute;
            top: 20px;
            left: 20px;
            border-radius: 210px 210px 0 0;
        }
        .gauge-needle {
            width: 4px;
            height: 100px;
            background: #334155;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform-origin: bottom center;
            transition: transform 0.8s ease-in-out;
            border-radius: 2px;
        }
        .gauge-center {
            width: 20px;
            height: 20px;
            background: #334155;
            border-radius: 50%;
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }
        .gauge-score {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2.25rem;
            font-weight: 700;
        }
        .flow-item {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .flow-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .api-reference {
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            height: 524px; /* Matches textarea height */
            overflow-y: auto;
            font-size: 0.9rem;
        }
        .api-reference-placeholder {
            color: #9ca3af;
        }
        .api-reference .path {
            font-family: monospace;
            font-weight: bold;
            font-size: 1.1em;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            color: #374151;
        }
        .api-reference .method {
            font-weight: bold;
            padding: 0.2rem 0.5rem;
            border-radius: 0.375rem;
            color: white;
            font-size: 0.8em;
        }
        .api-reference .method-get { background-color: #2563eb; }
        .api-reference .method-post { background-color: #16a34a; }
        .api-reference .method-put { background-color: #f59e0b; }
        .api-reference .method-delete { background-color: #dc2626; }
        .api-reference .description {
            margin-top: 0.5rem;
            color: #4b5563;
        }
    </style>
</head>
<body class="bg-primary">
    <!-- Navigation Bar -->
    <nav class="fixed top-0 left-0 right-0 bg-white/80 backdrop-blur-sm shadow-md z-40">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <a href="#" class="font-bold text-xl text-accent">The OpenAPI Imperative</a>
                </div>
                <div class="hidden md:block">
                    <div id="nav-links-desktop" class="ml-10 flex items-baseline space-x-4">
                        <a href="#ai-readiness-monitor" class="text-gray-600 hover:text-accent px-3 py-2 rounded-md text-sm font-medium transition">Monitor</a>
                        <a href="#workflow" class="text-gray-600 hover:text-accent px-3 py-2 rounded-md text-sm font-medium transition">Workflow</a>
                        <a href="#conclusion" class="text-gray-600 hover:text-accent px-3 py-2 rounded-md text-sm font-medium transition">Conclusion</a>
                        <button id="speaker-notes-btn" class="hidden bg-accent-light text-accent font-semibold px-3 py-2 rounded-md text-sm hover:bg-accent hover:text-white transition">Speaker Notes</button>
                    </div>
                </div>
                <div class="-mr-2 flex md:hidden">
                    <button id="mobile-menu-button" type="button" class="bg-gray-200 inline-flex items-center justify-center p-2 rounded-md text-gray-700 hover:text-gray-900 hover:bg-gray-300 focus:outline-none">
                        <span class="sr-only">Open main menu</span>
                        <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                        <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
            </div>
        </div>
        <div class="md:hidden hidden" id="mobile-menu">
            <div id="nav-links-mobile" class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                 <a href="#ai-readiness-monitor" class="text-gray-600 hover:bg-gray-200 hover:text-gray-900 block px-3 py-2 rounded-md text-base font-medium">Monitor</a>
                <a href="#workflow" class="text-gray-600 hover:bg-gray-200 hover:text-gray-900 block px-3 py-2 rounded-md text-base font-medium">Workflow</a>
                <a href="#conclusion" class="text-gray-600 hover:bg-gray-200 hover:text-gray-900 block px-3 py-2 rounded-md text-base font-medium">Conclusion</a>
                 <button id="speaker-notes-btn-mobile" class="hidden w-full text-left bg-accent-light text-accent font-semibold block px-3 py-2 rounded-md text-base hover:bg-accent hover:text-white transition">Speaker Notes</button>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12 pt-28">

        <!-- Header -->
        <header class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4">The Spec is the Interface</h1>
            <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto">Your OpenAPI specification is no longer just documentation. Let us explore how the OpenAPI Specification is evolving from a backend formality into a dynamic, conversational interface for both humans and AI.</p>
        </header>

        <!-- AI Readiness Monitor Section -->
        <section id="ai-readiness-monitor" class="mb-20">
            <div class="bg-secondary p-6 sm:p-8 rounded-xl shadow-lg border border-gray-200">
                <h2 class="text-3xl font-bold text-center mb-4">AI Readiness Monitor</h2>
                <p class="text-center text-gray-600 max-w-3xl mx-auto mb-8">How well will an AI understand your API? Paste your OpenAPI 3.x spec (in YAML or JSON) below, or load a file, to get an instant health check. The monitor analyzes your spec for semantic richness and best practices crucial for AI interpretability.</p>
                
                <div class="grid lg:grid-cols-5 gap-8">
                    <div class="lg:col-span-3">
                        <div class="flex justify-between items-center mb-2">
                            <label for="spec-input" class="block text-sm font-medium text-gray-700">OpenAPI 3.x Specification</label>
                            <fieldset class="flex items-center space-x-4">
                                <legend class="sr-only">Specification Format</legend>
                                 <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="spec-format" value="yaml" id="format-yaml" class="h-4 w-4 text-accent border-gray-300 focus:ring-accent" checked>
                                    <span class="ml-2 text-sm text-gray-600">YAML</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="spec-format" value="json" id="format-json" class="h-4 w-4 text-accent border-gray-300 focus:ring-accent">
                                    <span class="ml-2 text-sm text-gray-600">JSON</span>
                                </label>
                            </fieldset>
                        </div>
                        <textarea id="spec-input" rows="16" class="block w-full border border-gray-300 rounded-lg shadow-sm focus:ring-accent focus:border-accent p-4 font-mono text-sm" placeholder="openapi: 3.0.0
info:
  title: My Awesome API
  version: 1.0.0
  description: An API to demonstrate semantic richness.
paths:
  /items:
    get:
      summary: Get all items
      operationId: getItems
      responses:
        '200':
          description: A list of items."></textarea>
                        <input type="file" id="file-input" class="hidden" accept=".json,.yaml,.yml">
                    </div>
                    <div class="lg:col-span-2 flex flex-col">
                        <h3 class="text-xl font-semibold text-center mb-4">Semantic Health</h3>
                        <div id="gauge" class="flex flex-col items-center justify-center bg-primary p-4 rounded-lg">
                            <div class="gauge-container">
                                <div class="gauge-background"></div>
                                <div class="gauge-mask" style="background-color: #f1f5f9;"></div>
                                <div id="gauge-needle" class="gauge-needle" style="transform: rotate(-90deg);"></div>
                                <div class="gauge-center"></div>
                                <div id="gauge-score" class="gauge-score text-slate-700">0</div>
                            </div>
                            <p class="text-sm text-gray-500 mt-2">Initial Score</p>
                        </div>
                        <div class="mt-4 flex flex-col space-y-3">
                            <button id="load-spec-btn" class="w-full bg-gray-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-gray-700 transition shadow">Load Spec from File</button>
                            <button id="analyze-spec-btn" class="w-full bg-accent text-white font-semibold py-3 px-4 rounded-lg hover:bg-blue-600 transition shadow">Analyze Specification</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analysis Report Section -->
            <div id="analysis-report-container" class="mt-12 hidden">
                <h3 class="text-2xl font-bold text-center mb-6">Analysis Report</h3>
                <div class="overflow-x-auto bg-white rounded-lg shadow border border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">OpenAPI Field</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Purpose for AI</th>
                            </tr>
                        </thead>
                        <tbody id="analysis-report-body" class="bg-white divide-y divide-gray-200">
                           <!-- Rows will be injected by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- AI Fixer Section -->
            <div id="ai-fixer-container" class="mt-12 hidden">
                <h3 class="text-2xl font-bold text-center mb-6">AI-Powered Refinement</h3>
                <div class="grid lg:grid-cols-2 gap-8 items-start">
                    <!-- Original Column -->
                    <div>
                        <h4 class="text-lg font-semibold text-center mb-2">Before</h4>
                        <div class="grid spec-render-grid gap-4">
                            <div>
                                <label for="original-spec-output" class="block text-xs font-medium text-gray-500 mb-1">Original Specification</label>
                                <textarea id="original-spec-output" rows="24" class="block w-full border border-gray-300 rounded-lg shadow-sm p-4 font-mono text-sm bg-gray-100" readonly></textarea>
                            </div>
                            <div>
                                <label for="original-api-reference" class="block text-xs font-medium text-gray-500 mb-1">Generated API Reference</label>
                                <div id="original-api-reference" class="api-reference">
                                    <p class="api-reference-placeholder">API Reference will appear here...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Improved Column -->
                    <div>
                         <h4 class="text-lg font-semibold text-center mb-2">After AI Refinement</h4>
                         <div class="grid spec-render-grid gap-4">
                            <div>
                                <label for="fixed-spec-output" class="block text-xs font-medium text-gray-500 mb-1">AI-Improved Specification</label>
                                <div class="relative">
                                     <textarea id="fixed-spec-output" rows="24" class="block w-full border border-gray-300 rounded-lg shadow-sm p-4 font-mono text-sm" placeholder="Click 'Fix it!' to see the AI-improved spec..."></textarea>
                                     <div id="fixer-loader" class="absolute inset-0 bg-white/80 flex flex-col items-center justify-center rounded-lg hidden">
                                        <svg class="animate-spin h-8 w-8 text-accent" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                                        <p class="mt-2 text-gray-600">AI is thinking...</p>
                                     </div>
                                </div>
                            </div>
                            <div>
                                <label for="fixed-api-reference" class="block text-xs font-medium text-gray-500 mb-1">Generated API Reference</label>
                                <div id="fixed-api-reference" class="api-reference">
                                     <p class="api-reference-placeholder">Improved reference will appear here...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                 <div class="text-center my-8">
                     <button id="fix-it-btn" class="bg-green-600 text-white font-semibold py-3 px-5 rounded-full hover:bg-green-700 transition shadow-lg text-lg flex items-center mx-auto disabled:bg-gray-400 disabled:cursor-not-allowed">
                        <span class="text-2xl mr-2">✨</span>
                        <span>Fix it!</span>
                     </button>
                </div>
            </div>
        </section>

        <!-- AI-Augmented Workflow -->
        <section id="workflow" class="mb-20">
            <h2 class="text-3xl font-bold text-center mb-4">The New AI-Augmented Workflow</h2>
            <p class="text-center text-gray-600 max-w-3xl mx-auto mb-12">The documentation lifecycle is being reinvented. It starts with a high-quality spec, which is used by an LLM to generate drafts. Human experts then refine this content, adding the crucial context and nuance that only they can provide, resulting in rich, interactive experiences.</p>
            <div class="flex flex-col md:flex-row items-center justify-center gap-4 md:gap-0">
                 <div class="flow-item bg-secondary p-6 rounded-xl shadow-md text-center w-full md:w-auto">
                    <div class="text-4xl mb-2">🎨</div>
                    <h4 class="font-bold">1. Design</h4>
                    <p class="text-sm text-gray-500">Craft a sematically expressive OpenAPI spec.</p>
                </div>
                <div class="text-2xl text-gray-400 mx-4 hidden md:block">&rarr;</div>
                <div class="text-2xl text-gray-400 my-4 md:hidden">&darr;</div>
                <div class="flow-item bg-secondary p-6 rounded-xl shadow-md text-center w-full md:w-auto">
                    <div class="text-4xl mb-2">🤖</div>
                    <h4 class="font-bold">2. Generate</h4>
                    <p class="text-sm text-gray-500">Use an LLM to generate draft docs from the spec.</p>
                </div>
                <div class="text-2xl text-gray-400 mx-4 hidden md:block">&rarr;</div>
                 <div class="text-2xl text-gray-400 my-4 md:hidden">&darr;</div>
                <div class="flow-item bg-secondary p-6 rounded-xl shadow-md text-center w-full md:w-auto">
                    <div class="text-4xl mb-2">✍️</div>
                    <h4 class="font-bold">3. Refine</h4>
                    <p class="text-sm text-gray-500">Humans add context and validate accuracy.</p>
                </div>
                 <div class="text-2xl text-gray-400 mx-4 hidden md:block">&rarr;</div>
                 <div class="text-2xl text-gray-400 my-4 md:hidden">&darr;</div>
                <div class="flow-item bg-secondary p-6 rounded-xl shadow-md text-center w-full md:w-auto">
                    <div class="text-4xl mb-2">🚀</div>
                    <h4 class="font-bold">4. Interact</h4>
                    <p class="text-sm text-gray-500">Publish as interactive docs and sandboxes.</p>
                </div>
            </div>
        </section>

        <!-- Conclusion Section -->
        <section id="conclusion" class="py-16 bg-secondary rounded-xl shadow-lg border border-gray-200">
            <div class="text-center max-w-4xl mx-auto px-4">
                <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">Your Next Moves: From Specification to Intelligence</h2>
                
                <p class="text-lg text-gray-600 mb-8">
                    The line between writing code and writing for conversation has vanished. The OpenAPI Specification is no longer a static blueprint; it is a <strong class="text-accent">live, conversational interface</strong>—the very DNA of interaction for both human developers and the AI agents who are now our most demanding users.
                </p>
                
                <div class="grid md:grid-cols-3 gap-8 mb-12 text-left">
                    <div class="bg-primary p-6 rounded-lg border border-gray-200">
                        <h3 class="font-bold text-xl mb-2 text-accent">API Designers must become...</h3>
                        <p class="font-semibold text-gray-800 text-2xl">Interface Architects</p>
                        <p class="text-gray-600 mt-2">Using tools like the AI Readiness Monitor to analyze and design specs as first-class user interfaces. Every field is an opportunity to improve clarity for both human and AI consumers.</p>
                    </div>
                    <div class="bg-primary p-6 rounded-lg border border-gray-200">
                         <h3 class="font-bold text-xl mb-2 text-accent">Technical Writers must become...</h3>
                        <p class="font-semibold text-gray-800 text-2xl">AI Workflow Managers</p>
                        <p class="text-gray-600 mt-2">Orchestrating the human-AI partnership. Using AI to generate the first draft of a spec, then applying their expertise to add the essential context, nuance, and narrative that only a human can provide.</p>
                    </div>
                    <div class="bg-primary p-6 rounded-lg border border-gray-200">
                         <h3 class="font-bold text-xl mb-2 text-accent">Product Leaders must see...</h3>
                        <p class="font-semibold text-gray-800 text-2xl">A Strategic Investment</p>
                        <p class="text-gray-600 mt-2">Viewing the investment in AI-augmented workflows not as a cost, but as a critical path to creating higher quality, more discoverable, and ultimately more valuable API products. The spec is the product.</p>
                    </div>
                </div>
                
                <p class="text-xl font-semibold text-gray-700 mt-12">The future isn't about writing better static pages; it's about architecting smarter interactions.</p>
            </div>
        </section>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
             // --- GLOBAL STATE ---
            let currentSpecObject = null;
            let currentReportData = null;

            // --- UI ELEMENTS ---
            const analyzeBtn = document.getElementById('analyze-spec-btn');
            const loadBtn = document.getElementById('load-spec-btn');
            const fileInput = document.getElementById('file-input');
            const specInput = document.getElementById('spec-input');
            const reportContainer = document.getElementById('analysis-report-container');
            const reportBody = document.getElementById('analysis-report-body');
            const fixerContainer = document.getElementById('ai-fixer-container');
            const originalSpecOutput = document.getElementById('original-spec-output');
            const originalApiReference = document.getElementById('original-api-reference');
            const fixedSpecOutput = document.getElementById('fixed-spec-output');
            const fixedApiReference = document.getElementById('fixed-api-reference');
            const fixItBtn = document.getElementById('fix-it-btn');
            const fixerLoader = document.getElementById('fixer-loader');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');

            // --- DATA ---
            const reportChecks = [
                { key: 'info.title', field: 'info.title & description', purpose: 'High-level overview of API capabilities, target users, and ideal use cases.' },
                { key: 'paths.{...}.description', field: 'paths.{...}.description', purpose: 'Detailed explanation of an operation\'s capability, *why* and *when* to use it.' },
                { key: 'operationId', field: 'operationId', purpose: 'Unique, machine-friendly identifier used by AI to reference and call the operation.' },
                { key: 'parameters', field: 'parameters.*', purpose: 'Defines data type, format, and validation rules to guide AI in generating valid parameter values.' },
                { key: 'examples', field: 'examples', purpose: 'Concrete request/response payloads that show the AI how to structure requests.' },
                { key: 'responses', field: 'responses.{...}', purpose: 'Explains what an HTTP status code means, helping AI to interpret outcomes and handle errors.' },
                { key: 'securitySchemes', field: 'securitySchemes', purpose: 'Defines security mechanisms (e.g., API Key, OAuth2) so the AI can authenticate.' }
            ];

            // --- EVENT LISTENERS ---
            loadBtn.addEventListener('click', () => fileInput.click());

            fileInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    specInput.value = e.target.result;
                    if (file.name.endsWith('.json')) {
                        document.getElementById('format-json').checked = true;
                    } else if (file.name.endsWith('.yaml') || file.name.endsWith('.yml')) {
                        document.getElementById('format-yaml').checked = true;
                    }
                };
                reader.readAsText(file);
            });

            analyzeBtn.addEventListener('click', () => {
                reportContainer.classList.add('hidden');
                fixerContainer.classList.add('hidden');

                const specString = specInput.value;
                if (!specString.trim()) {
                    alert('Please paste or load an OpenAPI specification.');
                    updateGauge('gauge-needle', 'gauge-score', 0);
                    return;
                }

                const format = document.querySelector('input[name="spec-format"]:checked').value;
                try {
                    currentSpecObject = format === 'yaml' ? jsyaml.load(specString) : JSON.parse(specString);
                    if (typeof currentSpecObject !== 'object' || currentSpecObject === null) throw new Error();
                } catch (e) {
                    alert(`Invalid ${format.toUpperCase()} Format. Please check for syntax errors.`);
                    updateGauge('gauge-needle', 'gauge-score', 0);
                    return;
                }
                
                const { score, reportData } = analyzeSpec(currentSpecObject);
                currentReportData = reportData;

                updateGauge('gauge-needle', 'gauge-score', score);
                displayReport(reportData);
                
                originalSpecOutput.value = specString;
                renderApiReference(currentSpecObject, originalApiReference);

                fixedSpecOutput.value = '';
                fixedApiReference.innerHTML = `<p class="api-reference-placeholder">Improved reference will appear here...</p>`;
                fixerContainer.classList.remove('hidden');
            });

            fixItBtn.addEventListener('click', async () => {
                if (!currentSpecObject || !currentReportData) return;
                
                fixerLoader.style.display = 'flex';
                fixItBtn.disabled = true;

                await new Promise(resolve => setTimeout(resolve, 1500));

                const fixedSpec = fixSpecWithAI(currentSpecObject, currentReportData);
                const format = document.querySelector('input[name="spec-format"]:checked').value;
                
                fixedSpecOutput.value = format === 'yaml' ? jsyaml.dump(fixedSpec, { indent: 2, noRefs: true }) : JSON.stringify(fixedSpec, null, 2);
                renderApiReference(fixedSpec, fixedApiReference);
                
                fixerLoader.style.display = 'none';
                fixItBtn.disabled = false;
            });

            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
                mobileMenuButton.querySelectorAll('svg').forEach(icon => icon.classList.toggle('hidden'));
            });

            document.querySelectorAll('nav a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    if (!mobileMenu.classList.contains('hidden')) {
                         mobileMenu.classList.add('hidden');
                         mobileMenuButton.querySelectorAll('svg').forEach(icon => icon.classList.toggle('hidden'));
                    }
                });
            });

            // --- CORE FUNCTIONS ---
            function updateGauge(needleId, scoreId, score) {
                const needle = document.getElementById(needleId);
                const scoreEl = document.getElementById(scoreId);
                const rotation = -90 + (score / 100) * 180;
                needle.style.transform = `rotate(${rotation}deg)`;
                
                let currentScore = 0;
                const targetScore = Math.round(score);
                const increment = Math.max(1, Math.round(score / 50));
                
                const interval = setInterval(() => {
                    currentScore += increment;
                    if (currentScore >= targetScore) {
                        currentScore = targetScore;
                        clearInterval(interval);
                    }
                    scoreEl.textContent = currentScore;
                }, 15);
                 if (score === 0) scoreEl.textContent = 0;
                
                scoreEl.className = 'gauge-score ';
                if(score >= 80) scoreEl.classList.add('text-green-600');
                else if (score >= 50) scoreEl.classList.add('text-yellow-600');
                else scoreEl.classList.add('text-red-600');
            }
            
            function displayReport(reportData) {
                reportBody.innerHTML = '';
                reportChecks.forEach(checkInfo => {
                    const status = reportData[checkInfo.key];
                    const icon = status ? '<span class="text-green-500 text-xl">✓</span>' : '<span class="text-red-500 text-xl">✗</span>';
                    const row = document.createElement('tr');
                    row.innerHTML = `<td class="px-6 py-4 whitespace-nowrap text-center">${icon}</td><td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-800">${checkInfo.field}</td><td class="px-6 py-4 text-sm text-gray-600">${checkInfo.purpose}</td>`;
                    reportBody.appendChild(row);
                });
                reportContainer.classList.remove('hidden');
            }
            
            function renderApiReference(spec, container) {
                if (!spec || !spec.info || !spec.paths) {
                    container.innerHTML = '<p class="api-reference-placeholder">Invalid or empty spec provided.</p>';
                    return;
                }
                let html = ``;
                html += `<h2 class="text-2xl font-bold">${spec.info.title || 'API Title'}</h2>`;
                html += `<p class="text-gray-500 text-sm mb-4">${spec.info.description || '<em class="text-red-500">[No description provided]</em>'}</p>`;

                for (const path in spec.paths) {
                    html += `<div class="path">${path}</div>`;
                    for (const method in spec.paths[path]) {
                        const op = spec.paths[path][method];
                        html += `<div class="my-2"><span class="method method-${method.toLowerCase()}">${method.toUpperCase()}</span>`;
                        if (op.summary) {
                            html += `<span class="ml-2 font-semibold">${op.summary}</span>`;
                        }
                        html += `</div>`;
                        if (op.description) {
                            html += `<p class="description">${op.description}</p>`;
                        } else {
                             html += `<p class="description"><em class="text-red-500">[No operation description provided]</em></p>`;
                        }
                    }
                }
                container.innerHTML = html;
            }

            function analyzeSpec(spec) {
                let reportData = {};
                let totalScore = 0;
                let maxScore = 0;
                const check = value => value && String(value).trim().length > 5;

                maxScore += 15;
                reportData['info.title'] = check(spec.info?.description);
                if(reportData['info.title']) totalScore += 15;
                
                maxScore += 10;
                reportData['securitySchemes'] = spec.components?.securitySchemes && Object.keys(spec.components.securitySchemes).length > 0;
                if(reportData['securitySchemes']) totalScore += 10;
                
                let opCount = 0, opWithDesc = 0, opWithId = 0, paramCount = 0, paramWithDesc = 0, responseCount = 0, responseWithDesc = 0;
                if (spec.paths && Object.keys(spec.paths).length > 0) {
                    for (const path in spec.paths) {
                        for (const method in spec.paths[path]) {
                            const op = spec.paths[path][method];
                            if (typeof op !== 'object' || op === null) continue;
                            opCount++;
                            if (check(op.description)) opWithDesc++;
                            if (check(op.operationId)) opWithId++;
                            if (op.parameters) {
                                op.parameters.forEach(p => { if(p.in) { paramCount++; if (check(p.description)) paramWithDesc++; } });
                            }
                            if (op.responses) {
                                Object.keys(op.responses).forEach(status => { responseCount++; if (check(op.responses[status].description)) responseWithDesc++; });
                            }
                        }
                    }
                }

                reportData['operationId'] = opCount > 0 && opWithId === opCount;
                reportData['paths.{...}.description'] = opCount > 0 && opWithDesc === opCount;
                reportData['parameters'] = paramCount > 0 ? paramWithDesc === paramCount : true;
                reportData['responses'] = responseCount > 0 && responseWithDesc === responseCount;

                maxScore += 60;
                if (opCount > 0) {
                    totalScore += (opWithId / opCount) * 15;
                    totalScore += (opWithDesc / opCount) * 15;
                    totalScore += (paramCount > 0 ? (paramWithDesc / paramCount) : 1) * 15;
                    totalScore += (responseCount > 0 ? (responseWithDesc / responseCount) : 1) * 15;
                }
                
                maxScore += 15;
                reportData['examples'] = JSON.stringify(spec).includes('"example"');
                if (reportData['examples']) totalScore += 15;

                const finalScore = maxScore > 0 ? (totalScore / maxScore) * 100 : 0;
                return { score: Math.round(finalScore), reportData };
            }

            function fixSpecWithAI(spec, reportData) {
                let fixedSpec = JSON.parse(JSON.stringify(spec));
                const check = value => value && String(value).trim().length > 5;

                if (!reportData['info.title']) {
                    if (!fixedSpec.info) fixedSpec.info = { title: "New API", version: "1.0.0" };
                    fixedSpec.info.description = `Provides capabilities to manage ${fixedSpec.info.title || 'resources'}. It allows users to create, retrieve, update, and delete data through a standardized interface.`;
                }

                if (!reportData['securitySchemes']) {
                    if (!fixedSpec.components) fixedSpec.components = {};
                    if (!fixedSpec.components.securitySchemes) fixedSpec.components.securitySchemes = {};
                    fixedSpec.components.securitySchemes.apiKeyAuth = { type: 'apiKey', in: 'header', name: 'X-API-KEY' };
                    if (!fixedSpec.security) fixedSpec.security = [{ apiKeyAuth: [] }];
                }
                
                if (fixedSpec.paths) {
                    for (const path in fixedSpec.paths) {
                        for (const method in fixedSpec.paths[path]) {
                            const op = fixedSpec.paths[path][method];
                            if (!op) continue;

                            if (!check(op.operationId)) {
                                const pathParts = path.replace(/[\{\}]/g, '').split('/').filter(p => p);
                                const opId = method.toLowerCase() + pathParts.map(p => p.charAt(0).toUpperCase() + p.slice(1)).join('');
                                op.operationId = opId || `${method}Root`;
                            }

                            if (!check(op.description)) {
                                op.description = `This operation allows a user to ${method.toUpperCase()} resources at the ${path} endpoint. It is critical for the primary workflow.`;
                            }

                            if (op.parameters) {
                                op.parameters.forEach(p => {
                                    if (p.in && !check(p.description)) p.description = `The ${p.name} used to identify a specific resource.`;
                                });
                            }
                            
                            if (op.responses) {
                                for (const status in op.responses) {
                                     if (!check(op.responses[status].description)) {
                                         const successText = (status.startsWith('2')) ? 'Successful' : 'Error';
                                         op.responses[status].description = `${successText} response for status code ${status}.`;
                                     }
                                }
                            }
                        }
                    }
                }
                
                if (!reportData['examples'] && fixedSpec.components?.schemas) {
                     for(const schemaName in fixedSpec.components.schemas){
                         const schema = fixedSpec.components.schemas[schemaName];
                         if (schema && schema.properties && !schema.example) {
                             const example = {};
                             Object.entries(schema.properties).forEach(([propName, propDetails]) => {
                                 if(propDetails.type === 'string') example[propName] = `Sample ${propName}`;
                                 else if(propDetails.type === 'integer') example[propName] = 123;
                                 else if(propDetails.type === 'boolean') example[propName] = true;
                                 else example[propName] = "sample";
                             });
                             schema.example = example;
                         }
                     }
                }

                return fixedSpec;
            }
        });
    </script>
</body>
</html>
